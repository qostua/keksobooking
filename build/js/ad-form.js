import{CustomValidation,resetValidityInput,checkInput}from"./validation.js";import{removePreviewAvatar,removePreviewPhoto,setAvatarChooserChange,setAdImageChooserChange}from"./preview-image.js";import{sendData}from"./api.js";import{showAlert}from"./utils.js";const minPriceToOfferType={bungalow:0,flat:1e3,hotel:3e3,house:5e3,palace:1e4},capacityValuesToRoomNumber={1:["1"],2:["1","2"],3:["1","2","3"],100:["0"]},roomNumberValuesToCapacity={0:["100"],1:["1","2","3"],2:["2","3"],3:["3"]},adForm=document.querySelector(".ad-form"),adTitleInput=adForm.querySelector("#title"),adAddressInput=adForm.querySelector("#address"),adPriceInput=adForm.querySelector("#price"),adTypeSelect=adForm.querySelector("#type"),adTimeinInput=adForm.querySelector("#timein"),adTimeoutInput=adForm.querySelector("#timeout"),adRoomNumberSelect=adForm.querySelector("#room_number"),adCapacitySelect=adForm.querySelector("#capacity"),submitAdForm=adForm.querySelector(".ad-form__submit"),resetBtnAdForm=adForm.querySelector(".ad-form__reset"),titleValidityChecks=[{getInvalidityMessage:e=>e.validity.valueMissing?"Это обязательное поле":""},{getInvalidityMessage:e=>e.validity.tooShort?`Ещё ${e.minLength-e.value.length} симв.`:""},{getInvalidityMessage:e=>e.validity.tooLong?`Уберите ${e.value.length-e.maxLength} симв.`:""}],priceValidityChecks=[{getInvalidityMessage:e=>e.validity.rangeUnderflow?`Не меньше ${e.min} руб.`:""},{getInvalidityMessage:e=>e.validity.rangeOverflow?`Не больше ${e.max} руб.`:""},{getInvalidityMessage:e=>e.validity.valueMissing?"Это обязательное поле":""},{getInvalidityMessage:e=>e.validity.badInput?"Введите числовое значение":""}],roomNumberValidityChecks=[{getInvalidityMessage(){const e=adRoomNumberSelect.value,t=adCapacitySelect.value;return roomNumberValuesToCapacity[t].includes(e)?"":"100"===e?"Такое количество комнат не подходит для гостей":`Для такого количества комнат доступно следующее количество гостей: ${capacityValuesToRoomNumber[e].join(", ")}`}}];adTitleInput.CustomValidation=new CustomValidation(titleValidityChecks),adPriceInput.CustomValidation=new CustomValidation(priceValidityChecks),adCapacitySelect.CustomValidation=new CustomValidation(roomNumberValidityChecks);const setAddressValue=e=>{adAddressInput.value=e},setMinPriceInput=e=>{const t=minPriceToOfferType[e];Number.isFinite(t)&&(adPriceInput.min=t,adPriceInput.placeholder=t)},activateSubmit=()=>{submitAdForm.disabled=!1},resetAdForm=()=>{adForm.reset(),removePreviewAvatar(),removePreviewPhoto();adForm.querySelectorAll("input, select, textarea").forEach((e=>{e.CustomValidation&&resetValidityInput(e)}))};adForm.addEventListener("input",(e=>{e.target.CustomValidation&&checkInput(e.target)})),adTypeSelect.addEventListener("change",(()=>{setMinPriceInput(adTypeSelect.value),""!==adPriceInput.value&&checkInput(adPriceInput)})),adCapacitySelect.addEventListener("change",(()=>{checkInput(adCapacitySelect)})),adRoomNumberSelect.addEventListener("change",(()=>{checkInput(adCapacitySelect)})),adTimeinInput.addEventListener("change",(()=>{adTimeoutInput.value=adTimeinInput.value})),adTimeoutInput.addEventListener("change",(()=>{adTimeinInput.value=adTimeoutInput.value})),setAvatarChooserChange(),setAdImageChooserChange(),submitAdForm.addEventListener("click",(()=>{adForm.querySelectorAll("input, select, textarea").forEach((e=>{e.CustomValidation&&checkInput(e)}))}));const setAdFormSubmit=e=>{adForm.addEventListener("submit",(t=>{t.preventDefault(),submitAdForm.disabled=!0,sendData((()=>e()),(()=>{showAlert("error"),activateSubmit()}),new FormData(t.target))}))},setResetBtnClick=e=>{resetBtnAdForm.addEventListener("click",(t=>{t.preventDefault(),e()}))};export{setAddressValue,setAdFormSubmit,activateSubmit,setResetBtnClick,resetAdForm};